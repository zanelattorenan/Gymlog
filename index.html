<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GymLog Simples</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen flex justify-center">
  <div class="w-full max-w-3xl bg-white shadow-lg rounded-xl m-3 p-4 space-y-4">
    <h1 class="text-2xl font-bold text-slate-800 text-center">
      GymLog – Treinos A / B / C / D / E
    </h1>

    <!-- Tabs -->
    <div class="flex border-b text-sm">
      <button id="tab-today" class="px-4 py-2 border-b-2 border-blue-600 text-blue-600 font-semibold"
              onclick="switchView('today')">Treino de hoje</button>
      <button id="tab-calendar" class="px-4 py-2 text-slate-600"
              onclick="switchView('calendar')">Calendário</button>
      <button id="tab-history" class="px-4 py-2 text-slate-600"
              onclick="switchView('history')">Histórico por exercício</button>
    </div>

    <!-- Treino de hoje -->
    <section id="view-today" class="space-y-4">
      <p class="text-sm text-slate-500">
        Hoje: <span id="today-date" class="font-semibold"></span>
      </p>

      <div>
        <p class="text-sm font-medium mb-1">Selecione o treino do dia:</p>
        <div id="workout-buttons" class="flex gap-2 flex-wrap">
          <!-- Botões A–E -->
        </div>
      </div>

      <div id="exercise-list" class="space-y-3">
        <p class="text-slate-500 text-sm italic">
          Escolha um treino para ver os exercícios.
        </p>
      </div>

      <button id="save-today-btn"
              class="hidden w-full bg-emerald-600 text-white font-semibold py-2 rounded-lg hover:bg-emerald-700 text-sm"
              onclick="saveToday()">
        Salvar treino de hoje
      </button>

      <p id="msg" class="text-xs text-center text-slate-500"></p>
    </section>

    <!-- Calendário -->
    <section id="view-calendar" class="space-y-4 hidden">
      <div class="flex items-center justify-between">
        <button class="p-1" onclick="changeMonth(-1)">&#9664;</button>
        <p id="month-label" class="font-semibold"></p>
        <button class="p-1" onclick="changeMonth(1)">&#9654;</button>
      </div>

      <div class="grid grid-cols-7 text-center text-xs font-medium text-slate-500">
        <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
      </div>
      <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-xs"></div>

      <div id="day-details" class="hidden border rounded-lg p-3 bg-slate-50">
        <p id="day-details-title" class="font-semibold mb-2"></p>
        <div id="day-details-body" class="space-y-1 text-sm"></div>
      </div>
    </section>

    <!-- Histórico por exercício -->
    <section id="view-history" class="space-y-4 hidden">
      <div>
        <label class="text-sm font-medium block mb-1">Escolha um exercício:</label>
        <select id="exercise-select" class="w-full border rounded-lg p-2 text-sm"
                onchange="renderExerciseHistory()">
          <option value="">-- selecione --</option>
        </select>
      </div>
      <div id="exercise-history" class="space-y-2 text-sm">
        <p class="text-slate-500 italic text-sm">
          Selecione um exercício para ver a evolução da carga.
        </p>
      </div>
    </section>
  </div>

  <script>

     // ---------- Dados fixos dos treinos ----------
    const WORKOUTS = {
      A: {
        nome: "Treino A (Quadríceps / Glúteo)",
        exercises: [
          { name: "Agachamento no smith", reps: "4x12" },
          { name: "Leg 45º", reps: "4x10" },
          { name: "Afundo", reps: "3x10 cada perna" },
          { name: "Cadeira extensora", reps: "4x12" },
          { name: "Adutora máquina", reps: "4x10" },
          { name: "Panturrilha na máquina", reps: "4x15" },
          { name: "Abdominal supra", reps: "4x15" },
        ],
      },
      B: {
        nome: "Treino B (Costas / Bíceps)",
        exercises: [
          { name: "Puxador frente", reps: "4x12" },
          { name: "Remada baixa aberta", reps: "4x10" },
          { name: "Remada curvada cavalinho (pegada neutra)", reps: "4x12" },
          { name: "Rosca corda polia", reps: "4x12" },
          { name: "Rosca Scott", reps: "4x10" },
          { name: "Face pull", reps: "4x12" },
          { name: "Abdominal infra", reps: "4x10" },
        ],
      },
      C: {
        nome: "Treino C (Posterior / Glúteo)",
        exercises: [
          { name: "Agachamento sumô com halteres", reps: "4x12" },
          { name: "Mesa flexora", reps: "4x10" },
          { name: "Cadeira flexora", reps: "4x12" },
          { name: "Cadeira abdutora", reps: "4x15" },
          { name: "Elevação pélvica", reps: "4x10" },
          { name: "Panturrilha no smith", reps: "4x15" },
          { name: "Abdominal oblíquo", reps: "4x20 totais" },
        ],
      },
      D: {
        nome: "Treino D (Peito / Ombro / Tríceps)",
        exercises: [
          { name: "Supino reto máquina", reps: "4x12" },
          { name: "Supino inclinado máquina", reps: "3x12" },
          { name: "Fly", reps: "4x12" },
          { name: "Tríceps corda", reps: "4x12" },
          { name: "Tríceps máquina", reps: "3x15" },
          { name: "Elevação lateral com halteres", reps: "4x12" },
          { name: "Hiperextensão lombar", reps: "4x10" },
        ],
      },
      E: {
        nome: "Treino E (Quadríceps / Posterior / Glúteo)",
        exercises: [
          { name: "Agachamento smith", reps: "4x10" },
          { name: "Leg 45º", reps: "4x10" },
          { name: "Cadeira extensora", reps: "4x12" },
          { name: "Mesa flexora", reps: "4x10" },
          { name: "Abdutora", reps: "3x15" },
          { name: "Elevação pélvica", reps: "4x12" },
          { name: "Panturrilha na máquina", reps: "4x15" },
        ],
      },
    };

    // ---------- Storage ----------
    const STORAGE_KEY = "gymlog-registros-v1";
    function loadLogs() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      } catch {
        return [];
      }
    }
    function saveLogs(logs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
    }

    // ---------- Estado ----------
    let logs = loadLogs();
    let selectedWorkout = null;
    let currentMonth = new Date();

    // ---------- Util ----------
    function todayISO() {
      return new Date().toISOString().slice(0, 10);
    }
    function formatBR(dateISO) {
      const [y, m, d] = dateISO.split("-");
      return `${d}/${m}/${y}`;
    }

    // ---------- Tabs ----------
    function switchView(view) {
      document.getElementById("view-today").classList.add("hidden");
      document.getElementById("view-calendar").classList.add("hidden");
      document.getElementById("view-history").classList.add("hidden");
      document.getElementById("tab-today").classList.remove("border-b-2","border-blue-600","text-blue-600","font-semibold");
      document.getElementById("tab-calendar").classList.remove("border-b-2","border-blue-600","text-blue-600","font-semibold");
      document.getElementById("tab-history").classList.remove("border-b-2","border-blue-600","text-blue-600","font-semibold");

      document.getElementById(`view-${view}`).classList.remove("hidden");
      document.getElementById(`tab-${view}`).classList.add("border-b-2","border-blue-600","text-blue-600","font-semibold");

      if (view === "calendar") renderCalendar();
      if (view === "history") fillExerciseSelect();
    }

    // ---------- Treino de hoje ----------
    function renderWorkoutButtons() {
      const container = document.getElementById("workout-buttons");
      container.innerHTML = "";
      ["A","B","C","D","E"].forEach(letter => {
        const btn = document.createElement("button");
        btn.textContent = letter;
        btn.className =
          "px-3 py-1 rounded-full border text-sm " +
          "hover:bg-blue-50 hover:border-blue-500";
        btn.onclick = () => selectWorkout(letter);
        container.appendChild(btn);
      });
    }

    function selectWorkout(letter) {
      selectedWorkout = letter;
      // estilo
      document.querySelectorAll("#workout-buttons button").forEach(b => {
        b.classList.remove("bg-blue-600","text-white","border-blue-600");
      });
      const btn = Array.from(document.querySelectorAll("#workout-buttons button"))
        .find(b => b.textContent === letter);
      if (btn) btn.classList.add("bg-blue-600","text-white","border-blue-600");

      renderExerciseList();
    }

    function renderExerciseList() {
      const container = document.getElementById("exercise-list");
      const btnSave = document.getElementById("save-today-btn");
      if (!selectedWorkout || !WORKOUTS[selectedWorkout]) {
        container.innerHTML = "<p class='text-slate-500 text-sm italic'>Selecione um treino.</p>";
        btnSave.classList.add("hidden");
        return;
      }
      const workout = WORKOUTS[selectedWorkout];
      const today = todayISO();

      const lastByExercise = {};
      logs
        .filter(l => l.exercise && l.date === today && l.workout === selectedWorkout)
        .forEach(l => { lastByExercise[l.exercise] = l; });

      const html = workout.exercises.map(ex => {
        const last = logs
          .filter(l => l.exercise === ex.name)
          .sort((a,b) => b.timestamp - a.timestamp)[0];
        const todayLast = lastByExercise[ex.name];
        const lastText = last
          ? `<span class="text-xs text-slate-500">Última: ${last.weight} kg em ${formatBR(last.date)} (Treino ${last.workout})</span>`
          : "";
        const initWeight = todayLast ? todayLast.weight : "";
        const initObs = todayLast ? todayLast.note : "";

        return `
          <div class="border rounded-lg p-3 bg-slate-50 space-y-1" data-ex="${ex.name}">
            <p class="font-medium text-sm">${ex.name}</p>
            <p class="text-xs text-slate-500">Séries / reps: ${ex.reps}</p>
            ${lastText}
            <div class="flex gap-2 mt-1">
              <input type="number" step="0.5" placeholder="kg"
                     class="w-24 border rounded px-2 text-sm"
                     value="${initWeight}" />
              <input type="text" placeholder="obs"
                     class="flex-1 border rounded px-2 text-sm"
                     value="${initObs}" />
            </div>
          </div>
        `;
      }).join("");
      container.innerHTML = html;
      btnSave.classList.remove("hidden");
    }

    function saveToday() {
      if (!selectedWorkout) {
        showMsg("Selecione um treino antes de salvar.");
        return;
      }
      const date = todayISO();
      const items = document.querySelectorAll("#exercise-list [data-ex]");
      const newLogs = [];

      items.forEach(div => {
        const name = div.dataset.ex;
        const [weightInput, noteInput] = div.querySelectorAll("input");
        const weight = parseFloat(weightInput.value.replace(",", ".")) || 0;
        const note = noteInput.value.trim();
        if (weight > 0 || note) {
          newLogs.push({
            date,
            workout: selectedWorkout,
            exercise: name,
            weight,
            note,
            timestamp: Date.now(),
          });
        }
      });

      if (!newLogs.length) {
        showMsg("Nenhum exercício com carga/obs preenchida.");
        return;
      }

      logs = logs.concat(newLogs);
      saveLogs(logs);
      showMsg(`Treino ${selectedWorkout} salvo com ${newLogs.length} registros.`);
      renderCalendar();   // já atualiza calendário
      fillExerciseSelect();
      renderExerciseHistory();
    }

    function showMsg(text) {
      const el = document.getElementById("msg");
      el.textContent = text;
      if (!text) return;
      setTimeout(() => { el.textContent = ""; }, 3000);
    }

    // ---------- Calendário ----------
    function changeMonth(delta) {
      currentMonth.setMonth(currentMonth.getMonth() + delta);
      renderCalendar();
    }

    function renderCalendar() {
      const label = document.getElementById("month-label");
      const grid = document.getElementById("calendar-grid");
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth(); // 0–11
      label.textContent = currentMonth.toLocaleDateString("pt-BR", {
        month: "long",
        year: "numeric",
      });

      grid.innerHTML = "";
      const first = new Date(y, m, 1);
      const firstWeekday = first.getDay(); // 0=dom
      const daysInMonth = new Date(y, m + 1, 0).getDate();

      for (let i = 0; i < firstWeekday; i++) {
        grid.innerHTML += "<div></div>";
      }

      // mapa dateISO -> letra do treino
      const byDate = {};
      logs.forEach(l => {
        if (!byDate[l.date]) byDate[l.date] = new Set();
        byDate[l.date].add(l.workout);
      });

      for (let d = 1; d <= daysInMonth; d++) {
        const dateISO = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
        const workoutsSet = byDate[dateISO];
        let labelWorkout = "";
        if (workoutsSet) {
          const arr = Array.from(workoutsSet);
          labelWorkout = arr.length === 1 ? arr[0] : "+";
        }
        const hasWorkout = !!workoutsSet;

        const baseClasses =
          "border rounded-lg h-12 flex flex-col items-center justify-center cursor-pointer text-xs";
        const classes = hasWorkout
          ? baseClasses + " bg-blue-600 text-white"
          : baseClasses + " bg-white text-slate-700 hover:bg-slate-50";

        grid.innerHTML += `
          <div class="${classes}" onclick="showDayDetails('${dateISO}')">
            <span>${d}</span>
            ${labelWorkout ? `<span class="font-bold text-sm">${labelWorkout}</span>` : ""}
          </div>
        `;
      }

      document.getElementById("day-details").classList.add("hidden");
    }

    function showDayDetails(dateISO) {
      const box = document.getElementById("day-details");
      const title = document.getElementById("day-details-title");
      const body = document.getElementById("day-details-body");

      const dayLogs = logs
        .filter(l => l.date === dateISO)
        .sort((a,b) => a.exercise.localeCompare(b.exercise));

      title.textContent = `Treinos em ${formatBR(dateISO)}`;
      if (!dayLogs.length) {
        body.innerHTML = "<p class='text-slate-500 text-sm'>Nenhum registro.</p>";
      } else {
        body.innerHTML = dayLogs.map(l => `
          <div class="flex justify-between border-b py-1">
            <div>
              <p class="text-sm font-medium">${l.exercise}</p>
              <p class="text-xs text-slate-500">
                Treino ${l.workout} – ${l.weight} kg
                ${l.note ? ` – ${l.note}` : ""}
              </p>
            </div>
          </div>
        `).join("");
      }
      box.classList.remove("hidden");
    }

    // ---------- Histórico por exercício ----------
    function fillExerciseSelect() {
      const select = document.getElementById("exercise-select");
      const existing = select.value;
      const allNames = new Set();
      Object.values(WORKOUTS).forEach(w => {
        w.exercises.forEach(e => allNames.add(e.name));
      });
      const list = Array.from(allNames).sort();
      select.innerHTML = '<option value="">-- selecione --</option>';
      list.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });
      if (existing) select.value = existing;
    }

    function renderExerciseHistory() {
      const select = document.getElementById("exercise-select");
      const name = select.value;
      const container = document.getElementById("exercise-history");
      if (!name) {
        container.innerHTML =
          "<p class='text-slate-500 italic text-sm'>Selecione um exercício.</p>";
        return;
      }
      const hist = logs
        .filter(l => l.exercise === name)
        .sort((a,b) => b.timestamp - a.timestamp);

      if (!hist.length) {
        container.innerHTML =
          `<p class='text-slate-500 text-sm'>Nenhum registro ainda para "${name}".</p>`;
        return;
      }

      container.innerHTML = hist.map(l => `
        <div class="border-l-4 border-emerald-500 bg-emerald-50 px-3 py-2 flex justify-between">
          <div>
            <p class="text-sm font-semibold">${l.weight} kg</p>
            <p class="text-xs text-slate-600">
              Treino ${l.workout} – ${formatBR(l.date)}
              ${l.note ? `<br><span class="text-slate-500">Obs: ${l.note}</span>` : ""}
            </p>
          </div>
        </div>
      `).join("");
    }

    // ---------- Init ----------
    (function init() {
      document.getElementById("today-date").textContent = formatBR(todayISO());
      renderWorkoutButtons();
      switchView("today");
    })();
  </script>
</body>
</html>
